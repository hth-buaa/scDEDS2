weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
print(Sys.time() - t3)
#
t3 = Sys.time()
for (times in 1:4) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.9
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.1
weights_max[weights_max == 0] <- 1
# weights_max[19] = 8315
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:4) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
print(Sys.time() - t3)
t3 = Sys.time()
for (times in 1:5) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.9
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.1
weights_max[weights_max == 0] <- 1
# weights_max[19] = 8315
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:5) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
print(Sys.time() - t3)
#
t3 = Sys.time()
for (times in 1:10) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.9
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.1
weights_max[weights_max == 0] <- 1
# weights_max[19] = 8315
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:10) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
t3 = Sys.time()
for (times in 1:10) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.95
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.05
weights_max[weights_max == 0] <- 1
# weights_max[19] = 8315
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:10) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
t3 = Sys.time()
for (times in 1:10) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.98
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.02
weights_max[weights_max == 0] <- 1
weights_max[19] = 8315
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:10) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
t3 = Sys.time()
for (times in 1:10) {
rgs_df_list = list()
ncore = 78
re_best = as.numeric(rgs_df_top1[1,]); re_best[25] = 0; print(re_best)
# weights_best = c(0.02530531,0.1428782,0.4110941,0.1280393,0.2314860,0.1173414,0.4186929,0.08676184,0.8904961,0.7006830,0.02676145,0.2041813,0.02571671,0.3475293,0.4404260,0.08311705,0.4560963,0.2930431,1990)
weights_best = re_best[6:24]
n_test = 18 #; weights_best[n_test]
n_data = 4#; n_test = c(12,14,10,   9,5,7,6,8)[1:n_data]
# weights_min = c(rep(0, 18), 0.9)
# weights_min = c(as.numeric(1:18 == n_test), 0.9)
# weights_min = c(pmax(weights_min[1:18] - 0.15, 0), weights_min[19] - 1000)
# weights_min = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_min <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_min5.rds")
# weights_min = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_min = weights_min * 0.9
weights_min = weights_best * 0.98
# weights_min[n_test] = 0 # weights_min[19] = 1000
# weights_max = c(rep(1, 18), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% n_test), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(as.numeric(1:18 %in% c(7, 10, 9, 5)), nrow(interest_cell_type_peak_TG_pred_bak[[1]][[level]][["peak_TG"]]))
# weights_max = c(pmax(weights_min[1:18] + 0.15, 0), weights_min[19] + 1000)
# weights_max = c(0.02593069,0.1402610,0.4204128,0.12719771,0.2416575,0.1221885,0.4251438,0.09245817,0.8388794,0.6972279,0.02671883,0.2007659,0.02615778,0.3443297,0.4626986,0.08731230,0.4877925,0.2925276,2057)
# weights_max <- readRDS("/mnt/i/STREAM_Recurrence/2-benchmark/10-visualization/weights_max5.rds")
# weights_max = c(0.02111459,0.001895593,0.01414495,0.001168330,0.03419743,0.0008341273,0.8167755,0.003486849,0.05230240,0.06026279,0.001440818,0.008605403,0.0005316764,0.01854428,0.0006844129,0.00008781846,0.003826950,0.005160407,8315)
# weights_max = weights_max * 1.1
weights_max = weights_best * 1.02
weights_max[weights_max == 0] <- 1
weights_max[19] = weights_max[19]*0.98
# weights_max[n_test] = max(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
# weights_max[n_test] = min(0.1, weights_best[n_test] * 10) # weights_max[19] = 40000
t1 = Sys.time()
# for (iter in c(1:9, 40)) {
for (iter in 1:10) {
# for (iter in 21:30) {
# for (iter in 31:40) {
# for (iter in 11:50) {
# for (iter in 41:50) {
# for (iter in 48) {
# iter=1
t11 = Sys.time()
print(iter)
nhead = max(40 - iter, 2) + 1
# nhead = 10
nsamp = 200 + iter * 10 ^ (1 + min(10, n_data) / 10)
# nsamp = 4000
# t12 = Sys.time()
rgs0 <- mclapply(1:nsamp, run_single_iteration, mc.cores = ncore)
# print(Sys.time()-t12)
rgs <- list()
for (i in 1:length(rgs0)) {rgs <- c(rgs, rgs0[[i]])}
if (iter == 1) {
namee = paste(round(re_best[6:24]), collapse = "_")
rgs[[namee]] = rgs[[1]]
rgs[[namee]][1, ] = c(re_best)
rm(namee)
}
rgs_df_list[[iter]] <- do.call(rbind, rgs) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top = do.call(rbind, rgs_df_list) %>% arrange(desc(f.score)) %>% slice_head(n = nhead)
rgs_df_top1 = rgs_df_top
rownames(rgs_df_top1) = NULL
colnames(rgs_df_top1) = NULL
print(round(rgs_df_top1, digits = 4))
weights_max = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, max, na.rm = TRUE)
weights_min = apply(rgs_df_top[, -c(1:5, ncol(rgs_df_top))], 2, min, na.rm = TRUE)
print(round(as.numeric(weights_min), digits = 4))
print(round(as.numeric(weights_max), digits = 4))
print(Sys.time()-t11)
}
print(Sys.time()-t1)
saveRDS(rgs_df_list, paste0("./rgs_df_list__", data.ls, "__test", n_data, ".rds"))
saveRDS(rgs_df_top, paste0("./rgs_df_top__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_max, paste0("./weights_max__", data.ls, "__test", n_data, ".rds"))
saveRDS(weights_min, paste0("./weights_min__", data.ls, "__test", n_data, ".rds"))
print(rgs_df_top1[1,,drop=F])
print(paste0("times = ", times))
# View(rgs_df_top)
#
}
