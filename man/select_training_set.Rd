% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_training_set.R
\name{select_training_set}
\alias{select_training_set}
\title{Select Training Sets in Dataset}
\usage{
select_training_set(
  interest_cell_type_branch_iGRN = interest_cell_type_branch_iGRN,
  interest_cell_type_group = interest_cell_type_group,
  top_n_for_max_theta_in_each_regulon = 1,
  max_theta_retention_rate_in_tops = 1,
  max_theta_retention_rate_in_all = 1,
  retention_number_of_tops = 1000,
  refine = TRUE,
  keep_all_TF = TRUE,
  top_ratio_in_refine = 1,
  ncores = 1
)
}
\arguments{
\item{interest_cell_type_branch_iGRN}{The output of function get_branch_iGRN.}

\item{interest_cell_type_group}{The output of function cell_grouping.}

\item{top_n_for_max_theta_in_each_regulon}{Positive integer. Number of top theta values to keep for each TF and each TG independently. Default is 1.}

\item{max_theta_retention_rate_in_tops}{Numeric between 0 and 1. Quantile threshold applied to thetas within the initial training set. Default is 1 (100\%).}

\item{max_theta_retention_rate_in_all}{Numeric between 0 and 1. Quantile threshold applied to thetas from all possible interactions. Default is 1 (100\%).}

\item{retention_number_of_tops}{Positive integer. Number of top theta interactions to retain. Default is 1000.}

\item{refine}{Logical. If TRUE, further refines the training set by requiring mutual top membership (TF in top regulons of TG, and TG in top regulons of TF) and retains a top ratio. Default is TRUE.}

\item{keep_all_TF}{Logical. When \code{refine = TRUE}, if TRUE, ensure that each TF is included in the training set.}

\item{top_ratio_in_refine}{Numeric between 0 and 1. When \code{refine = TRUE}, retains the top proportion of thetas. Default is 1 (100\%).}

\item{ncores}{See in ?get_interest_cell_type_data.}
}
\value{
A nested list structure organized by cell type and branch, containing:
\itemize{
\item For each branch: A data frame with training datasets including:
\itemize{
\item \code{TG}: Target gene identifier
\item \code{TF}: Transcription factor identifier
\item \code{theta_i}: Regulatory strength from iGRN
\item \code{TFE_K}, \code{TGA_K}, \code{TGE_K}: Cell group state features for each time point
}\item An "all" element containing the combined training dataset across all branches
}
}
\description{
Selects high-confidence regulatory interactions from iGRN to construct training datasets for predictive modeling.
The function applies multiple filtering criteria based on regulatory strength (theta) and integrates cell group state features (TFE, TGA, TGE) for each selected TF–TG pair.
}
\details{
The function performs the following key operations:
\enumerate{
\item Generates all possible TF–TG pairs from the iGRN and attaches the regulatory strength (theta_i).
\item For each TF and each TG, independently selects the top \code{top_n_for_max_theta_in_each_regulon} interactions (by theta_i) to form an initial training set.
\item Applies three threshold filters to the initial training set: (a) a quantile threshold on the thetas within the training set (\code{max_theta_retention_rate_in_tops}), (b) a quantile threshold on the thetas from all interactions (\code{max_theta_retention_rate_in_all}), and (c) an absolute number threshold (\code{retention_number_of_tops}). The final training set must satisfy all three.
\item If \code{refine} is TRUE and \code{keep_all_TF} is FALSE, further refines the training set by keeping only those interactions where the TF appears in the top regulons of the TG and the TG appears in the top regulons of the TF, and then retains the top \code{top_ratio_in_refine} of thetas.
\item If \code{refine} is TRUE and \code{keep_all_TF} is TRUE, retrieve the training set with missing TF on the refined results (theta_i maximum) to ensure that each TF is included in the training set.
\item For each branch, attaches the corresponding cell group state features (TFE, TGA, TGE) for each time point to the selected interactions.
\item Returns a list for each cell type, with each element corresponding to a branch (and an "all" element) containing the training set data frame.
}
}
\note{
Important considerations:
\itemize{
\item The function uses parallel processing (via \code{parallel::mclapply}) to speed up computation across cell types. Adjust \code{ncores} according to your system.
\item The training set selection is based on the regulatory strength (theta_i) from the iGRN. Ensure that the iGRN and cell group state features are properly generated by the upstream functions.
\item The refinement step (\code{refine=TRUE}) can significantly reduce the number of interactions, which may be beneficial for model training but may also remove some potentially important interactions. Adjust the parameters accordingly.
}
}
\section{Sampling Strategy}{

The function uses a stratified sampling approach to ensure that both the top regulators for each gene and the top targets for each TF are represented. The initial training set is formed by taking the top n interactions for each TF and each TG. Then, multiple thresholds are applied to further filter for high-confidence interactions.
}

\examples{
\dontrun{
interest_cell_type_branch_iGRN = base::readRDS("./3 get iGRN/interest_cell_type_branch_iGRN.rds")
interest_cell_type_group = base::readRDS("./2.2 Data Processing - Cell Grouping/interest_cell_type_group.rds")
top_n_for_max_theta_in_each_regulon = 1
max_theta_retention_rate_in_tops = 0.8
max_theta_retention_rate_in_all = 0.8
retention_number_of_tops = 1000
refine = TRUE
keep_all_TF = TRUE
top_ratio_in_refine = 0.8
ncores = parallel::detectCores() - 1 # in Linux
# ncores = 1 # in Windows
interest_cell_type_branch_training_set = select_training_set(
  interest_cell_type_branch_iGRN = interest_cell_type_branch_iGRN,
  interest_cell_type_group = interest_cell_type_group,
  top_n_for_max_theta_in_each_regulon = top_n_for_max_theta_in_each_regulon,
  max_theta_retention_rate_in_tops = max_theta_retention_rate_in_tops,
  max_theta_retention_rate_in_all = max_theta_retention_rate_in_all,
  retention_number_of_tops = retention_number_of_tops,
  refine = refine,
  keep_all_TF = keep_all_TF,
  top_ratio_in_refine = top_ratio_in_refine,
  ncores = ncores
)
}
}
