% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/infer_GRN.R
\name{infer_GRN}
\alias{infer_GRN}
\title{Infer Gene Regulatory Networks Using Trained Models}
\usage{
infer_GRN(
  interest_cell_type_branch_data_for_GRN_infer =
    interest_cell_type_branch_data_for_GRN_infer,
  interest_cell_type_tao = interest_cell_type_tao,
  interest_cell_type_branch_model_train = interest_cell_type_branch_model_train,
  interest_cell_type_group = interest_cell_type_group,
  interest_cell_type_genes_pseudotime_info = interest_cell_type_genes_pseudotime_info,
  select_cell_type = NULL,
  select_branch = NULL,
  each = 1e+06,
  ncores = 1
)
}
\arguments{
\item{interest_cell_type_branch_data_for_GRN_infer}{The output of function get_data_for_inferring_GRN.}

\item{interest_cell_type_tao}{The output of function get_cell_type_tao.}

\item{interest_cell_type_branch_model_train}{The output of function model_train.}

\item{interest_cell_type_group}{The output of function cell_grouping.}

\item{interest_cell_type_genes_pseudotime_info}{The output of function get_genes_pseudotime_info.}

\item{select_cell_type}{Character vector or NULL. Specific cell types to process. If NULL, processes all cell types. Default is NULL.}

\item{select_branch}{Numeric vector or NULL. Specific branches to process. If NULL, processes all branches. Default is NULL.}

\item{each}{Integer. Maximum number of regulatory interactions to process in each parallel chunk. Default is 1,000,000.}

\item{ncores}{See in ?get_interest_cell_type_data.}
}
\value{
A nested list named \code{interest_cell_type_pGRN} organized by cell type and branch, containing:
\itemize{
\item For each branch: Two data frames:
\itemize{
\item \code{theta_p}: Predicted regulatory strengths for all TF-TG pairs (rows) using each trained model (columns)
\item \code{loss}: Fitting losses corresponding to each prediction
}
}
Additionally, saves each branch's results as an RDS file in the directory "./5 Infer GRN/".
}
\description{
Infers gene regulatory networks (GRN) by applying trained models to predict regulatory strengths for all potential TF-TG interactions.
The function processes data in parallel, calculates predicted regulatory strengths (theta_p) and fitting losses, and organizes results by cell type and branch.
It supports selective processing of specific cell types and branches for targeted analysis.
}
\details{
The inference process follows these steps:
\enumerate{
\item \strong{Data Preparation}: Selects target cell types/branches
\item \strong{Parallel Processing}: Partitions data into chunks of size \code{each} for efficient parallel computation
\item \strong{Model Application}: For each TF-TG pair, applies all trained models to predict regulatory strength:
\itemize{
\item Uses optimized parameters from training
\item Predicts theta_p by minimizing the prediction error
}
\item \strong{Result Aggregation}: Combines results from parallel chunks and saves as RDS files
\item \strong{Output Organization}: Returns structured list of predictions and losses
}
}
\note{
Important considerations:
\itemize{
\item Processing time scales with the number of TF-TG pairs and trained models
\item The \code{each} parameter controls memory usage; reduce if encountering memory issues
\item Results are automatically saved as RDS files for persistence
\item Use \code{select_cell_type} and \code{select_branch} for targeted analysis
\item Parallel processing significantly accelerates computation for large datasets
}
}
\examples{
\dontrun{
interest_cell_type_branch_data_for_GRN_infer = base::readRDS("./5 Infer GRN/interest_cell_type_branch_data_for_GRN_infer.rds")
interest_cell_type_tao = base::readRDS("./3 get iGRN/interest_cell_type_tao.rds")
interest_cell_type_branch_model_train = base::readRDS("./4.2 BUild Prediction Model/interest_cell_type_branch_model_train.rds")
interest_cell_type_group = base::readRDS("./2.2 Data Processing - Cell Grouping/interest_cell_type_group.rds")
interest_cell_type_genes_pseudotime_info = base::readRDS("./2.2 Data Processing - Cell Grouping/interest_cell_type_genes_pseudotime_info.rds")
each = 1000
ncores = parallel::detectCores() - 1 # in Linux
# ncores = 1 # in Windows

# way 1: one step (If the running memory is sufficient)
interest_cell_type_pGRN = infer_GRN(
  interest_cell_type_branch_data_for_GRN_infer = interest_cell_type_branch_data_for_GRN_infer,
  interest_cell_type_tao = interest_cell_type_tao,
  interest_cell_type_branch_model_train = interest_cell_type_branch_model_train,
  interest_cell_type_group = interest_cell_type_group,
  interest_cell_type_genes_pseudotime_info = interest_cell_type_genes_pseudotime_info,
  select_cell_type = NULL,
  select_branch = NULL,
  each = each,
  ncores = ncores
)
base::saveRDS(interest_cell_type_pGRN, file = "./5 Infer GRN/interest_cell_type_pGRN.rds")

# way 2: more steps but stable
# If the process is terminated due to memory issues, you can manually continue running it branch by branch (saving the results to interest_cell_type_pGRN).
interest_cell_type_pGRN = base::list()
for (cell_type in base::names(interest_cell_type_branch_data_for_GRN_infer)) {
  message("Infer cell type ", cell_type, ".")
  interest_cell_type_pGRN[[cell_type]] = base::list()
  for (n in 1:(base::length(interest_cell_type_branch_data_for_GRN_infer[[cell_type]]) - 1)) {
    message("Infer cell type ", cell_type, " branch ", n, ".")
    interest_cell_type_pGRN[[cell_type]][[base::paste0("branch", n)]] = infer_GRN(
      interest_cell_type_branch_data_for_GRN_infer = interest_cell_type_branch_data_for_GRN_infer,
      interest_cell_type_tao = interest_cell_type_tao,
      interest_cell_type_branch_model_train = interest_cell_type_branch_model_train,
      interest_cell_type_group = interest_cell_type_group,
      interest_cell_type_genes_pseudotime_info = interest_cell_type_genes_pseudotime_info,
      select_cell_type = cell_type,
      select_branch = n,
      each = each,
      ncores = ncores
    )[[cell_type]][[base::paste0("branch", n)]]
  }
}
base::saveRDS(interest_cell_type_pGRN, file = "./5 Infer GRN/interest_cell_type_pGRN.rds")
}
}
\seealso{
\code{\link[scDEDS]{R_cal}}, \code{\link[scDEDS]{Hill_cal}}, \code{\link[scDEDS]{S_cal}}
}
