% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_best_prediction.R
\name{select_best_prediction}
\alias{select_best_prediction}
\title{Select Best Predictions for Gene Regulatory Networks}
\usage{
select_best_prediction(
  interest_cell_type_pGRN = interest_cell_type_pGRN,
  interest_cell_type_branch_model_train = interest_cell_type_branch_model_train,
  interest_cell_type_tao = interest_cell_type_tao,
  interest_cell_type_genes_pseudotime_info = interest_cell_type_genes_pseudotime_info,
  fit_loss_quantile_threshold = 0.2,
  theta_p_quantile_threshold = 0.8,
  fit_loss_upper = 0.2,
  theta_p_lower = 0.2,
  each = 1e+06,
  ncores = 1
)
}
\arguments{
\item{interest_cell_type_pGRN}{The output of function infer_GRN.}

\item{interest_cell_type_branch_model_train}{The output of model_train.}

\item{interest_cell_type_tao}{The output of function get_cell_type_tao.}

\item{interest_cell_type_genes_pseudotime_info}{The output of function get_genes_pseudotime_info.}

\item{fit_loss_quantile_threshold}{Numeric between 0 and 1. Quantile threshold for filtering predictions based on loss. Default is 0.2 (20th percentile).}

\item{theta_p_quantile_threshold}{Numeric between 0 and 1. Quantile threshold for filtering predictions based on regulatory strength. Default is 0.8 (80th percentile).}

\item{fit_loss_upper}{Positive numeric. Upper bound for acceptable fitting loss. Default is 0.2.}

\item{theta_p_lower}{Numeric between 0 and 1. Lower bound for acceptable regulatory strength. Default is 0.2.}

\item{each}{See in ?infer_GRN.}

\item{ncores}{See in ?get_interest_cell_type_data.}
}
\value{
The input list \code{interest_cell_type_pGRN} with two additional elements for each cell type:
\itemize{
\item For each branch: A data frame \code{best_result} containing the best theta_p, loss, and the model used for each TF-TG pair.
\item A \code{pred_summary} data frame that integrates results across branches, with weighted averages for theta_p and fit_loss.
}
}
\description{
Filters and selects the best predictions from inferred gene regulatory networks (GRN) by applying multiple quality thresholds.
The function processes each cell type and branch independently, selects the optimal regulatory strength (theta_p) and fitting loss for each TF-TG pair, and integrates results across branches using weighted averaging based on cell counts.
}
\details{
The selection process follows a multi-step strategy:
\enumerate{
\item \strong{Threshold Calculation}: Determines loss and theta_p thresholds using quantiles and fixed bounds.
\item \strong{Parallel Processing}: Partitions data for efficient parallel computation.
\item \strong{Best Prediction Selection}: For each TF-TG pair, selects the best prediction based on a hierarchy of criteria:
\itemize{
\item Uses predictions with loss below the training loss maximum to find the best prediction.
\item If fails, uses predictions with loss below the calculated loss threshold to find the best prediction.
\item If fails, uses predictions with theta_p above the calculated theta_p threshold to find the best prediction.
\item If fails, selects the prediction with the minimum loss to find the best prediction.
}
\item \strong{Result Integration}: Combines branch-specific results using weighted averaging based on cell counts.
\item \strong{Quality Control}: Removes predictions with theta_p outside the range from 0.011 to 0.989.
}
}
\note{
Important considerations:
\itemize{
\item Parallel processing speeds up the selection, especially for large datasets.
\item The \code{each} parameter controls memory usage; reduce if memory issues occur.
\item The function modifies the input list by adding new elements; original data is preserved.
\item Adjust quantile thresholds to balance sensitivity and specificity.
}
}
\examples{
\dontrun{
interest_cell_type_pGRN = base::readRDS("./5 Infer GRN/interest_cell_type_pGRN.rds")
interest_cell_type_branch_model_train = base::readRDS("./4.2 BUild Prediction Model/interest_cell_type_branch_model_train.rds")
interest_cell_type_tao = base::readRDS("./3 get iGRN/interest_cell_type_tao.rds")
interest_cell_type_genes_pseudotime_info = base::readRDS("./2.2 Data Processing - Cell Grouping/interest_cell_type_genes_pseudotime_info.rds")
fit_loss_quantile_threshold1 = 0.2
theta_p_quantile_threshold1 = 0.8
fit_loss_upper1 = 0.2
theta_p_lower1 = 0.2
each = 1000
ncores = parallel::detectCores() - 1 # in Linux
# ncores = 1 # in Windows
interest_cell_type_pGRN = select_best_prediction(
  interest_cell_type_pGRN = interest_cell_type_pGRN,
  interest_cell_type_branch_model_train = interest_cell_type_branch_model_train,
  interest_cell_type_tao = interest_cell_type_tao,
  interest_cell_type_genes_pseudotime_info = interest_cell_type_genes_pseudotime_info,
  fit_loss_quantile_threshold = fit_loss_quantile_threshold1,
  theta_p_quantile_threshold = theta_p_quantile_threshold,
  fit_loss_upper = fit_loss_upper1,
  theta_p_lower = theta_p_lower1,
  each = each,
  ncores = ncores
)
base::saveRDS(interest_cell_type_pGRN, file = "./5 Infer GRN/interest_cell_type_pGRN.rds")
}
}
