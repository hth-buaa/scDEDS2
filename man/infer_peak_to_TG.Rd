% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/infer_peak_to_TG.R
\name{infer_peak_to_TG}
\alias{infer_peak_to_TG}
\title{Infer Peak-TG Relationships}
\usage{
infer_peak_to_TG(
  scRNAseq,
  scATACseq,
  interest_cell_type_pGRN = interest_cell_type_pGRN,
  results_identify_TGs = results_identify_TGs,
  weight_Accessibility_percentile = 1,
  weight_Expression_percentile = 1,
  weight_Accessibility_non_zero_ratio_percentile = 5,
  weight_Expression_non_zero_ratio_percentile = 5
)
}
\arguments{
\item{scRNAseq}{See in ?identify_TGs.}

\item{scATACseq}{See in ?identify_TGs.}

\item{interest_cell_type_pGRN}{The output of function filter_GRN.}

\item{results_identify_TGs}{The output of function identify_TGs.}

\item{weight_Accessibility_percentile}{A positive numeric value specifying the weight for the accessibility percentile in importance score calculations. Default is 1.}

\item{weight_Expression_percentile}{A positive numeric value specifying the weight for the expression percentile in importance score calculations. Default is 1.}

\item{weight_Accessibility_non_zero_ratio_percentile}{A positivenumeric value specifying the weight for the non-zero ratio percentile of accessibility in importance score calculations. Default is 5.}

\item{weight_Expression_non_zero_ratio_percentile}{A positivenumeric value specifying the weight for the non-zero ratio percentile of expression in importance score calculations. Default is 5.}
}
\value{
A nested list named \code{interest_cell_type_peak_TG_pred}, organized by cell type and filtering level (loose/strict). For each cell type and level, the list contains:
\itemize{
\item \code{TGs}: A character vector of unique target gene symbols that are present in both the filtered GRN predictions and the promoter peak annotations.
\itemize{
\item \code{peak}: Mean accessibility of the peak in non-zero cells.
\item \code{SYMBOL}: Mean accessibility of the peak in non-zero cells.
\item \code{Accessibility}: Mean accessibility of the peak in non-zero cells.
\item \code{Expression}: Mean expression of the TG in non-zero cells.
\item \code{Accessibility_percentile}, \code{Expression_percentile}: Percentile ranks of accessibility and expression.
\item \code{Accessibility_non_zero_ratio}, \code{Expression_non_zero_ratio}: Proportions of non-zero cells for the peak and TG.
\item \code{Accessibility_non_zero_ratio_percentile}, \code{Expression_non_zero_ratio_percentile}: Percentile ranks of Accessibility_non_zero_ratio and Expression_non_zero_ratio.
\item \code{Accessibility_non_zero_ratio}, \code{Expression_non_zero_ratio}: Proportions of non-zero cells for the peak and TG.
\item \code{peak_importance_score}, \code{TG_importance_score}, \code{peak_TG_importance_score}: Composite scores combining weighted percentiles.
\item \code{peak_importance_score_percentile}, \code{TG_importance_score_percentile}, \code{peak_TG_importance_score_percentile}: Percentile ranks of peak_importance_score, TG_importance_score, and peak_TG_importance_score.
\item \code{TG_count}, \code{peak_count}: The number of TG corresponding to each peak and the number of peak corresponding to each TG.
\item \code{TG_count_percentile}, \code{peak_count_percentile}: Percentile ranks of TG_count and peak_count
}
}
The structure is: \code{interest_cell_type_peak_TG_pred[[cell_type]][[level]][["TGs"]]} and \code{interest_cell_type_peak_TG_pred[[cell_type]][[level]][["peak_TG"]]}.
}
\description{
Infers regulatory relationships between chromatin accessibility peaks and target genes (TGs) by integrating scRNA-seq and scATAC-seq data with pre-computed gene regulatory network (GRN) predictions.
The function processes each cell type independently at two stringency levels (loose and strict) to identify target genes present in the filtered GRN, then retrieves promoter-annotated peaks associated with these genes and calculates multiple importance scores for each peak-TG pair.
}
\details{
This function performs the following key steps for each cell type and stringency level:
\enumerate{
\item \strong{Extract Target Genes}: Retrieves unique TG symbols from the GRN predictions (rows are named as "TF_to_TG").
\item \strong{Match Promoter Peaks}: Subsets the promoter-annotated peaks from \code{results_identify_TGs} to include only peaks associated with the extracted TGs. It merges gene symbols from the \code{SYMBOL} and \code{flank_geneSymbols} columns, splits entries by semicolon, and expands the data frame so each peak-TG pair has a single row.
\item \strong{Calculate Accessibility and Expression Metrics}: Computes mean accessibility and expression for non-zero cells, along with non-zero ratios (proportion of cells with non-zero values). Percentile ranks are calculated for these metrics.
\item \strong{Compute Importance Scores}: Generates composite scores using user-defined weights to prioritize peak-TG pairs based on accessibility and expression characteristics.
\item \strong{Filter and Structure Results}: Removes pairs where accessibility or expression is zero, and ensures TGs are consistent with the GRN predictions.
}
The "loose" level typically includes a broader set of TGs, while "strict" provides high-confidence targets. This enables integrative analysis of chromatin accessibility and GRN predictions to identify potential regulatory elements.
}
\note{
Important considerations when using this function:
\itemize{
\item The input \code{results_identify_TGs} must contain a properly formatted \code{peak_anno_promoter} component. Ensure promoter annotations are complete and use consistent gene symbols.
\item The function requires both scRNA-seq and scATAC-seq data to be normalized and processed (e.g., using \code{Seurat::NormalizeData} for RNA and \code{Signac::RunTFIDF} for ATAC). The data should cover the same set of cells or be integrated appropriately.
\item The weights for percentiles (e.g., \code{weight_Accessibility_percentile}) allow customization of importance scores. Adjust these based on the relative importance of accessibility versus expression in your analysis.
}
Afterwards, users can filter predicted TGs based on TG_importance_store or TG_importance_score_percentile, filter predicted peaks based on peak_importance_store or peak_importance_score_percentile, and filter predicted peak TG associations based on peak_TG_importance_store or peak_TG_importance_score_percentile.
}
\examples{
\dontrun{
scRNAseq = readRDS("./scRNAseq.rds")
scATACseq = readRDS("./scATACseq.rds")
interest_cell_type_pGRN = base::readRDS("./5 Infer GRN/interest_cell_type_pGRN.rds")
results_identify_TGs = base::readRDS("./1.1 Data Preprocessing - Identify TGs By Annotation/results_identify_TGs.rds")
weight_Accessibility_percentile = 1
weight_Expression_percentile = 1
weight_Accessibility_non_zero_ratio_percentile = 5
weight_Expression_non_zero_ratio_percentile = 5
interest_cell_type_peak_TG_pred = infer_peak_to_TG (
  scRNAseq = scRNAseq,
  scATACseq = scATACseq,
  interest_cell_type_pGRN = interest_cell_type_pGRN,
  results_identify_TGs = results_identify_TGs,
  weight_Accessibility_percentile = weight_Accessibility_percentile,
  weight_Expression_percentile = weight_Expression_percentile,
  weight_Accessibility_non_zero_ratio_percentile = weight_Accessibility_non_zero_ratio_percentile,
  weight_Expression_non_zero_ratio_percentile = weight_Expression_non_zero_ratio_percentile
)
base::saveRDS(interest_cell_type_peak_TG_pred, file = "./5 Infer GRN/interest_cell_type_peak_TG_pred.rds")
}
}
